<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscar Computadores</title>
  <link rel="icon" type="image/png" href="img/scanner.png">
  <style>
    :root{
      --brand:#900000;
      --brand-900:#700000;
      --ink:#e9ecef;
      --muted:#b9c0c7;
      --bg:#0b0b0c;
      --panel:#0f0f11;
      --card:#16181b;
      --card-border:#272a2f;
      --shadow:0 10px 28px rgba(0,0,0,.45);
      --radius:16px;
    }
    @media(prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      background:var(--bg); color:var(--ink); -webkit-font-smoothing:antialiased; line-height:1.55;
    }
    .topbar{background:#000;color:#fff;text-align:center;padding:14px 10px;font-weight:700;letter-spacing:.6px;border-bottom:4px solid var(--brand);}
    .wrapper{max-width:1100px;margin:28px auto 44px;padding:0 16px;}
    .frame{border:3px solid var(--brand);border-radius:var(--radius);padding:20px;background:var(--panel);box-shadow:var(--shadow);}
    .header{margin:10px;background:var(--brand);color:#fff;border-radius:18px;padding:18px 22px;text-align:center;box-shadow:0 10px 22px rgba(144,0,0,.35);}
    .header h1{margin:0;font-size:clamp(20px,3.2vw,28px);letter-spacing:.5px;}
    .card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.35);padding:18px;margin:12px;}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
    input{
      flex:1;min-width:220px;padding:12px 14px;border:1px solid #32363d;border-radius:10px;background:#101215;
      color:#e8edf3;font-size:16px;box-sizing:border-box;text-transform:uppercase;
    }
    input::placeholder{color:#8b94a3}
    .btn{
      appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer;
      transition:transform .12s ease,box-shadow .2s ease,background .2s ease,color .2s ease,border-color .2s ease;
      color:#fff;background:#0c0c0e;border:2px solid var(--brand);
      box-shadow:0 2px 0 rgba(0,0,0,.6), inset 0 0 12px rgba(144,0,0,.25);
    }
    .btn:hover{background:var(--brand);box-shadow:0 4px 10px rgba(144,0,0,.35);}
    .btn:active{transform:translateY(1px)}
    .muted{color:var(--muted);margin:8px 2px}
    .table-wrap{overflow:auto;border-radius:12px;border:1px solid #2b2f35}
    table{width:100%;border-collapse:collapse;background:#0f1114;color:#e9ecef}
    thead th{
      background:#15181c;color:#e9ecef;border-bottom:1px solid #2b2f35;padding:12px 10px;text-align:left;font-weight:800;font-size:14px;
    }
    tbody td{
      border-top:1px solid #23272d;padding:12px 10px;font-size:14px;color:#cfd6de;
    }
    tbody tr:hover{background:#15181c}
    .row-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .footer{text-align:center;color:#8c96a3;font-size:12px;margin: 6px 0 0;}
  </style>
</head>
<body>
  <script>
    const claveCorrecta = "computador@";
    const ingreso = prompt("üîê Ingresa la clave para acceder:");
    if (ingreso !== claveCorrecta) {
      alert("‚ùå Clave incorrecta. Acceso denegado.");
      window.location.href = "https://www.elsenordelosescaner.cl/";
    }
  </script>

  <div class="topbar">WWW.ELSE√ëORDELOSESCANER.CL</div>

  <div class="wrapper">
    <div class="frame">
      <div class="header"><h1>Buscar Computadores</h1></div>

      <div class="card">
        <div class="row">
          <input id="patente" placeholder="ABCD12">
          <button class="btn" onclick="buscar()">üîé Buscar por Patente</button>
          <button class="btn" onclick="listarTodo()">üìã Listar todo</button>
          <a class="btn" href="computador.html">‚Üê Volver</a>
        </div>
        <div id="info" class="muted">Ingresa una patente o lista todo.</div>

        <div class="table-wrap">
          <table id="tabla" style="display:none">
            <thead>
              <tr>
                <th>Patente</th>
                <th>Descripci√≥n Trabajo</th>
                <th>C√≥digos de aver√≠a</th>
                <th>Tel√©fono</th>
                <th>Tipo de Computadora</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>

      <div class="footer">¬© 2025 <strong>Benjamin Gonz√°lez</strong>. Todos los derechos reservados.</div>
    </div>
  </div>

<script>
  const API_URL = 'https://script.google.com/macros/s/AKfycby8WBaWWAnXmBQNnKcRolzpC9zTYs5E0WTtv4AHrwycRlGboHoNZetBuuT-zxwbLHJMtQ/exec';

  // JSONP helper
  function jsonp(url, cbName) {
    return new Promise((resolve) => {
      window[cbName] = (data) => { resolve(data); delete window[cbName]; script.remove(); };
      const script = document.createElement('script');
      script.src = `${url}&callback=${cbName}`;
      script.onerror = () => { resolve([]); script.remove(); };
      document.body.appendChild(script);
    });
  }

  function render(data) {
    const info = document.getElementById('info');
    const tabla = document.getElementById('tabla');
    const tbody = document.getElementById('tbody');

    if (!Array.isArray(data) || data.length === 0) {
      tabla.style.display = 'none';
      info.textContent = 'Sin resultados.';
      return;
    }

    tbody.innerHTML = '';
    data.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r['Patente'] || ''}</td>
        <td>${r['Descripci√≥n Trabajo'] || ''}</td>
        <td>${r['C√≥digos de aver√≠a'] || ''}</td>
        <td>${r['Tel√©fono'] || ''}</td>
        <td>${r['Tipo de Computadora'] || ''}</td>
      `;
      tbody.appendChild(tr);
    });

    info.textContent = `Resultados: ${data.length}`;
    tabla.style.display = '';
  }

  async function buscar() {
    const pat = document.getElementById('patente').value.trim().toUpperCase();
    if (!pat) { document.getElementById('info').textContent = 'Ingresa una patente.'; return; }
    document.getElementById('info').textContent = 'Buscando...';
    const data = await jsonp(`${API_URL}?funcion=buscarComputador&patente=${encodeURIComponent(pat)}`, 'cbBuscar');
    render(data);
  }

  async function listarTodo() {
    document.getElementById('info').textContent = 'Cargando todo...';
    const data = await jsonp(`${API_URL}?funcion=obtenerComputadores`, 'cbTodo');
    render(data);
  }
</script>
</body>
</html>
