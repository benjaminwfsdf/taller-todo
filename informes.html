<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.json">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Taller">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <meta name="theme-color" content="#000000">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Informe de Diagnóstico</title>

  <!-- === Protección ligera con usuario+PIN (modal + persistencia 12h en localStorage) === -->
  <style>
    #auth-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:99999;backdrop-filter:blur(2px)}
    #auth-card{background:#fff;width:min(92vw,380px);border:1px solid #000;border-radius:10px;padding:18px;box-shadow:0 4px 0 #000;font-family:Arial,sans-serif}
    #auth-card h3{margin:0 0 10px;font-size:18px}
    #auth-card .row{margin:8px 0}
    #auth-card input[type=text],#auth-card input[type=password]{width:100%;padding:10px;font-size:16px;border:1px solid #000;border-radius:6px}
    #auth-card button{margin-top:10px;width:100%;padding:10px;font-size:14px;cursor:pointer;border:1px solid #000;border-radius:6px;background:#fff;box-shadow:0 2px 0 #000}
    #auth-error{color:#b30000;font-size:12px;height:16px;margin-top:6px;font-weight:bold}
    .shake{animation:shake .2s linear 2}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
  </style>

  <style>
    @media print {
      @page { size: letter; margin: 6mm 20mm; }
      body { margin: 0; padding: 0; box-shadow: none; border: none; }
      .fab { display: none !important; }
    }

    body { font-family: Arial, sans-serif; margin: 0; background: #f2f2f2; }

    /* Contenedor exportable (la "hoja") */
    #paper {
      width: 21cm; min-height: 29.7cm;
      margin: 32px auto; padding: 40px; background: #fff;
      border: 1px solid #000; box-sizing: border-box; font-size: 13px;
      position: relative; /* estable */
    }

    .titulo {
      width: 100%; background: #b30000; color: #fff; font-weight: bold;
      font-size: 24px; padding: 12px 0; text-align: center; box-sizing: border-box; margin: 0 0 10px 0;
    }

    .contacto-wrap { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; gap:12px; }
    .contacto { text-align:center; font-size:14px; line-height:1.4; flex:1; font-weight:bold; }
    .contacto-wrap img { max-height:170px; object-fit:contain; }

    .form-grid { width:100%; border-collapse:collapse; margin-bottom:20px; }
    .form-grid td { padding:6px; border:1px solid #000; vertical-align:middle; }
    .form-grid label { font-weight:bold; margin-right:6px; min-width:60px; font-size:14px; }
    .inline { display:flex; align-items:center; gap:6px; }
    .form-grid input[type="text"] { width:100%; padding:2px 4px; box-sizing:border-box; border:1px solid #000; font-size:16px; }

    .seccion-titulo { font-weight:bold; margin-top:20px; margin-bottom:5px; text-transform:uppercase; background:#f0f0f0; padding:6px; border:1px solid #000; }

    .tabla-codigos { width:100%; border-collapse:collapse; margin-bottom:20px; table-layout:fixed; }
    .tabla-codigos th, .tabla-codigos td { border:1px solid #000; padding:8px; vertical-align:top; }
    .tabla-codigos th { background:#d9d9d9; font-weight:bold; text-align:left; }
    .tabla-codigos textarea { width:100%; height:220px; border:none; resize:none; font-size:16px; box-sizing:border-box; padding:6px; }

    textarea { width:100%; height:100px; margin-top:5px; padding:6px; border:1px solid #000; box-sizing:border-box; font-size:16px; }

    .valor-final { margin-top:20px; font-weight:bold; font-size:16px; display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; }
    .valor-final input { padding:10px 16px; border:2px solid #000; font-size:20px; font-weight:bold; width:180px; text-align:right; }
    .fecha-final { border:1px solid #000; padding:6px 12px; font-size:13px; color:#000; }

    .nota-footer { font-size:10px; text-align:center; margin-top:10px; font-weight:bold; }

    /* Botonera: SIEMPRE visible (móvil) */
    .fab {
      position: fixed; bottom: 16px; right: 16px;
      display:flex; flex-direction:column; gap:10px;
      z-index: 2147483647; /* super alto para móvil/PWA */
    }
    .fab button {
      padding: 12px 18px; font-size: 15px;
      border:1px solid #000; background:#fff; cursor:pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,.25); border-radius:10px;
      -webkit-tap-highlight-color: transparent;
    }
    .fab button:active { transform: translateY(1px); }
    @supports (-webkit-touch-callout: none) { .fab { bottom: 12px; right: 12px; } }

    /* Auto-grow SOLO códigos/detalle */
    #codigo_area, #detalle_area {
      width:100%; min-height:220px; height:auto; border:none; font-size:16px;
      box-sizing:border-box; padding:6px; resize:vertical; overflow:hidden;
    }
    
    /* Estilos para botones específicos */
    .boton-imprimir {
      background: #28a745 !important;
      color: white !important;
      border-color: #28a745 !important;
    }
    
    .boton-pdf {
      background: #007bff !important;
      color: white !important;
      border-color: #007bff !important;
    }
    
    .boton-qr {
      background: #6f42c1 !important;
      color: white !important;
      border-color: #6f42c1 !important;
    }
    
    .boton-borrar {
      background: #dc3545 !important;
      color: white !important;
      border-color: #dc3545 !important;
    }
    
    .boton-buscar-aplicacion {
      background: #ff9900 !important;
      color: #000 !important;
      border-color: #ff9900 !important;
    }
    
    /* Efecto hover para todos los botones */
    .fab button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
  </style>
</head>

<body onload="document.getElementById('fecha').innerText = new Date().toLocaleDateString('es-CL');">
  <!-- Modal auth -->
  <div id="auth-overlay" aria-hidden="true">
    <div id="auth-card">
      <h3>Acceso</h3>
      <p style="margin:0 0 6px; font-size:13px">Ingresa tus credenciales para continuar.</p>
      <div class="row"><input id="auth-user" name="username" type="text" inputmode="email" autocapitalize="none" autocorrect="off" placeholder="tu@correo.com" autocomplete="username" /></div>
      <div class="row"><input id="auth-pin" name="password" type="password" autocomplete="current-password" placeholder="••••••••" /></div>
      <div id="auth-error"></div>
      <button id="auth-btn">Entrar</button>
      <p style="font-size:11px;opacity:.7;margin-top:8px">Cerrar sesión: <b>Ctrl+L</b></p>
    </div>
  </div>

  <!-- ===== CONTENIDO DEL INFORME (exportaremos #paper a PDF) ===== -->
  <div id="paper">
    <div class="titulo">INFORME DE DIAGNOSTICO</div>

    <div class="contacto-wrap">
      <!-- IMPORTANTE: rutas relativas y CORS para html2canvas -->
      <img src="img/logo-scanners.png" alt="logo scanners" loading="eager" crossorigin="anonymous" />
      <div class="contacto">
        WWW.ELSEÑORDELOSESCANER.CL<br />
        DORSAL (ALTURA 6200) METRO NEPTUNO<br />
        CELULAR: +56976209564<br />
        (WALDO)<br /><br />
        SCANNER ORIGINAL TODAS LAS MARCAS<br />
        LIMPIEZA INYECTORES – SISTEMAS DPF - GASES LLAVES CON CHIP – PROGRAMACION
      </div>
      <img src="img/qr-whatsapp.png" alt="QR whatsapp" loading="eager" crossorigin="anonymous" />
    </div>

    <table class="form-grid">
      <tr>
        <td><div class="inline"><label>MARCA:</label><input type="text" name="marca" style="text-transform: uppercase;"></div></td>
        <td><div class="inline"><label>MODELO:</label><input type="text" name="modelo" style="text-transform: uppercase;"></div></td>
      </tr>
      <tr>
        <td><div class="inline"><label>PATENTE:</label><input type="text" name="patente" style="text-transform: uppercase;"></div></td>
        <td><div class="inline"><label>AÑO:</label><input type="text" name="ano" style="text-transform: uppercase;"></div></td>
      </tr>
      <tr>
        <td><div class="inline"><label>KM:</label><input type="text" name="km" style="text-transform: uppercase;"></div></td>
        <td><div class="inline"><label>MOTOR:</label><input type="text" name="motor" style="text-transform: uppercase;"></div></td>
      </tr>
    </table>

    <table class="tabla-codigos">
      <thead>
        <tr>
          <th style="width: 15%;">CÓDIGOS</th>
          <th style="width: 70%;">DETALLE</th>
          <th style="width: 15%;">VALOR</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><textarea name="codigo_area" id="codigo_area" style="text-transform: uppercase;"></textarea></td>
          <td><textarea name="detalle_area" id="detalle_area"></textarea></td>
          <td><textarea name="valor_area" id="valor_area"></textarea></td>
        </tr>
      </tbody>
    </table>

    <div class="seccion-titulo">POSIBLES CAUSAS</div>
    <textarea name="causas" id="causas"></textarea>

    <div class="seccion-titulo">RECOMENDACIONES</div>
    <textarea name="recomendaciones" id="recomendaciones"></textarea>

    <div class="valor-final">
      <div class="fecha-final" id="fecha"></div>
      <div>$ <input type="text" name="valor_final" id="valor_final"></div>
    </div>

    <div class="nota-footer">
      <strong>NOTA: COMPROBANTE VALIDO PARA SEGUNDO SCANNER (7 DÍAS)</strong>
    </div>
  </div><!-- /#paper -->

  <!-- ====== AUTH ====== -->
  <script>
    (function(){
      // SHA-256("informes@")
      const PASS_HASH = "76c4d54885353802045d21b7b97d9b892f5b7c72fd0eff29f366d9d44dd0b0cd";
      const HOURS_VALID = 12;
      const storeKey = "auth_until_ts";
      const STORAGE = localStorage;

      const $ov = document.getElementById('auth-overlay');
      const $user = document.getElementById('auth-user');
      const $pin = document.getElementById('auth-pin');
      const $btn = document.getElementById('auth-btn');
      const $err = document.getElementById('auth-error');

      const now = () => Date.now();
      const isAuthed = () => {
        const until = parseInt(STORAGE.getItem(storeKey) || "0", 10);
        return until && until > now();
      };
      const setAuthed = (h) => STORAGE.setItem(storeKey, String(now() + (h||HOURS_VALID)*3600*1000));
      const logout = () => { STORAGE.removeItem(storeKey); sessionStorage.removeItem(storeKey); location.reload(); };

      async function sha256Hex(text){
        const enc = new TextEncoder().encode(text);
        const buf = await crypto.subtle.digest("SHA-256", enc);
        return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
      }

      async function tryLogin(){
        $err.textContent = "";
        const pin = ($pin.value || "").trim();
        if (!pin) { $err.textContent = "Ingresa la clave."; $pin.focus(); return; }
        const h = await sha256Hex(pin);
        if (h === PASS_HASH){
          setAuthed(HOURS_VALID);
          $ov.style.display = "none";
          $ov.setAttribute("aria-hidden","true");
          try{
            if ('PasswordCredential' in window && 'credentials' in navigator){
              const username = ($user.value || 'usuario').trim();
              const cred = new window.PasswordCredential({ id: username, name: username, password: pin });
              await navigator.credentials.store(cred);
            }
          }catch(e){}
        } else {
          $err.textContent = "Clave incorrecta.";
          const card = document.getElementById('auth-card');
          card.classList.remove('shake'); void card.offsetWidth; card.classList.add('shake');
          $pin.select();
        }
      }

      if (!isAuthed()){
        $ov.style.display = "flex";
        $ov.setAttribute("aria-hidden","false");
        setTimeout(()=> ($user.value ? $pin.focus() : $user.focus()), 0);
      }

      $btn.addEventListener('click', tryLogin);
      $pin.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') tryLogin(); });

      document.addEventListener('keydown', (e)=>{
        if (e.ctrlKey && (e.key === 'l' || e.key === 'L')) { e.preventDefault(); logout(); }
      });
    })();
  </script>

  <!-- ====== Función para buscar aplicación ====== -->
  <script>
function buscarAplicacion() {
  guardarInformeLocal();
  sessionStorage.setItem('viene_de_busqueda', 'true');

  // URL ABSOLUTA (igual que el index)
  const url = "https://taller-todo.vercel.app/buscar_aplicacion.html";

  window.open(url, "_blank", "noopener");
}


    function guardarInformeLocal() {
      // Guardar todos los datos del informe en localStorage
      const datos = recogerDatosInforme();
      localStorage.setItem('informe_autoguardado', JSON.stringify(datos));
      localStorage.setItem('informe_autoguardado_timestamp', Date.now().toString());
    }
    
    function cargarInformeLocal() {
      // Cargar datos guardados al volver
      const guardado = localStorage.getItem('informe_autoguardado');
      if (guardado) {
        try {
          const datos = JSON.parse(guardado);
          const timestamp = parseInt(localStorage.getItem('informe_autoguardado_timestamp') || '0');
          const horasTranscurridas = (Date.now() - timestamp) / (1000 * 60 * 60);
          
          // Solo cargar si tiene menos de 2 horas
          if (horasTranscurridas < 2) {
            document.querySelector('input[name="marca"]').value = datos.marca || '';
            document.querySelector('input[name="modelo"]').value = datos.modelo || '';
            document.querySelector('input[name="patente"]').value = datos.patente || '';
            document.querySelector('input[name="ano"]').value = datos.ano || '';
            document.querySelector('input[name="km"]').value = datos.km || '';
            document.querySelector('input[name="motor"]').value = datos.motor || '';
            document.getElementById("codigo_area").value = datos.codigo || '';
            document.getElementById("detalle_area").value = datos.detalle || '';
            document.getElementById("valor_area").value = datos.valor_area || '';
            document.getElementById("causas").value = datos.causas || '';
            document.getElementById("recomendaciones").value = datos.recomendaciones || '';
            document.getElementById("valor_final").value = datos.valor_final || '';
          }
        } catch (e) {
          console.error("Error al cargar informe guardado:", e);
        }
      }
    }
    
    // Función para agregar producto seleccionado al informe
    function agregarProductoSeleccionado() {
      const productoGuardado = localStorage.getItem('producto_seleccionado');
      if (productoGuardado) {
        try {
          const producto = JSON.parse(productoGuardado);
          
          // Agregar al campo VALOR AREA
          const valorArea = document.getElementById("valor_area");
          const precio = producto.precio_unit ? parseFloat(producto.precio_unit) : 0;
          const nuevoValor = `${producto.nombre || 'Producto'} - $${precio.toLocaleString('es-CL')}`;
          
          // Agregar en una nueva línea si ya hay contenido
          if (valorArea.value.trim()) {
            valorArea.value = valorArea.value + '\n' + nuevoValor;
          } else {
            valorArea.value = nuevoValor;
          }
          
          // Limpiar el producto guardado
          localStorage.removeItem('producto_seleccionado');
          
          // Ajustar altura del textarea
          valorArea.style.height = 'auto';
          valorArea.style.height = (valorArea.scrollHeight + 2) + 'px';
          
        } catch (e) {
          console.error("Error al procesar producto seleccionado:", e);
          localStorage.removeItem('producto_seleccionado');
        }
      }
    }
    
    // Cargar datos al iniciar la página
    window.addEventListener('load', function() {
      // Verificar si venimos de la página de búsqueda
      const vieneDeBusqueda = sessionStorage.getItem('viene_de_busqueda') === 'true';
      
      if (vieneDeBusqueda) {
        sessionStorage.removeItem('viene_de_busqueda');
        cargarInformeLocal();
        // Pequeño delay para asegurar que los campos estén listos
        setTimeout(agregarProductoSeleccionado, 300);
      }
      
      // Auto-guardar cada 30 segundos
      setInterval(guardarInformeLocal, 30000);
    });
  </script>

  <!-- ====== Autorrelleno de DETALLE por códigos ====== -->
  <script>
    const CODIGOS_BASE = {
   
       "P252F": "Nivel de aceite muy alto",
       "P0420": "Eficiencia del sistema de catalizador por debajo del umbral (Banco 1)",
  "P0171": "Sistema demasiado pobre (Banco 1)",
  "P0300": "Falla de encendido aleatoria o múltiple",
  "P0113": "Sensor de temperatura del aire de admisión - entrada alta",
  "P0340": "Circuito del sensor de posición del árbol de levas - mal funcionamiento",
  "P0335": "Sensor de posición del cigüeñal - circuito defectuoso",
  "P0128": "Termostato del refrigerante - temperatura de funcionamiento por debajo del regulado",
  "P0172": "Sistema demasiado rico (Banco 1)",
  "P0011": "Posición del árbol de levas A - tiempo adelantado o rendimiento del sistema (Banco 1)",
  "P0016": "Sensor de posición del cigüeñal - correlación con el árbol de levas (Banco 1)",
  "P0102": "Sensor MAF - entrada baja",
  "P0135": "Sensor de oxígeno (Banco 1 Sensor 1) - calentador - mal funcionamiento del circuito",
  "P0299": "Presión del turbo/sobrealimentador por debajo del límite",
  "P0301": "Fallo de encendido del cilindro 1",
  "P0401": "Flujo insuficiente en el sistema EGR",
  "P0430": "Eficiencia del sistema de catalizador por debajo del umbral (Banco 2)",
  "P0087": "Presión de combustible/raíl - demasiado baja",
  "P0101": "Sensor MAF - rango/rendimiento",
  "P0141": "Sensor de oxígeno (Banco 1 Sensor 2) - calentador - mal funcionamiento del circuito",
  
  "P0100": "Mal funcionamiento del circuito de sensor MAF o volumen de air.",
  "P0101": "Rango o rendimiento del sensor MAF fuera de especificación.",
  "P0102": "Sensor MAF – señal baja de entrada.",
  "P0106": "Sensor MAP/ABS – rango o rendimiento fuera de especificación.",
  "P0107": "Sensor MAP/ABS – señal baja.",
  "P0108": "Sensor MAP/ABS – señal alta.",
  "P0110": "Mal funcionamiento del circuito del sensor de temperatura del aire de admisión.",
  "P0113": "Sensor de temperatura del aire de admisión – señal alta de entrada.",
  "P0118": "Sensor de temperatura del refrigerante del motor – señal alta de entrada.",
  "P0120": "Sensor de posición del acelerador A – mal funcionamiento de circuito.",
  "P0121": "Sensor de posición del acelerador A – rango/rendimiento fuera de especificación.",
  "P0122": "Sensor de posición del acelerador A – señal baja.",
  "P0123": "Sensor de posición del acelerador A – señal alta.",
  "P0128": "La temperatura del refrigerante está por debajo del rango regulado por el termostato.",
  "P0130": "Mal funcionamiento del circuito del sensor de O₂ (Banco 1, sensor 1).",
  "P0131": "Sensor de O₂ Banco 1, sensor 1 – bajo voltage.",
  "P0132": "Sensor de O₂ Banco 1, sensor 1 – alto voltage.",
  "P0134": "Sensor de O₂ Banco 1, sensor 1 – sin actividad.",
  "P0135": "Mal funcionamiento del calentador del sensor de O₂ (Banco 1, sensor 1).",
  "P0136": "Mal funcionamiento del circuito del sensor de O₂ (Banco 1, sensor 2).",
  "P0137": "Sensor de O₂ Banco 1, sensor 2 – bajo voltage.",
  "P0138": "Sensor de O₂ Banco 1, sensor 2 – alto voltage.",
  "P0141": "Mal funcionamiento del calentador del sensor de O₂ (Banco 1, sensor 2).",
  "P0171": "Sistema demasiado pobre (Banco 1).",
  "P0172": "Sistema demasiado rico (Banco 1).",
  "P0174": "Sistema demasiado pobre (Banco 2).",
  "P0200": "Mal funcionamiento del circuito del inyector de combustible (rango 0200-0299).",
  "P0234": "Turbo/sobrealimentador – presión excesiva detectada.",
  "P0299": "Turbo/sobrealimentador – rendimiento/nivel bajo.",
  "P0300": "Fallo de encendido aleatorio/múltiple cilindros detectado.",
  "P0301": "Fallo de encendido en el cilindro 1.",
  "P0302": "Fallo de encendido en el cilindro 2.",
  "P0303": "Fallo de encendido en el cilindro 3.",
  "P0304": "Fallo de encendido en el cilindro 4.",
  "P0305": "Fallo de encendido en el cilindro 5.",
  "P0306": "Fallo de encendido en el cilindro 6.",
  "P0307": "Fallo de encendido en el cilindro 7.",
  "P0308": "Fallo de encendido en el cilindro 8.",
  "P0321": "Sensor knock – rango/rendimiento fuera de especificación.",
  "P0325": "Sensor knock – mal funcionamiento del circuito (Banco 1).",
  "P0328": "Sensor knock – señal alta (Banco 1 o sensor único).",
  "P0335": "Mal funcionamiento del circuito del sensor de posición del cigüeñal (CKP).",
  "P0340": "Mal funcionamiento del circuito del sensor de posición del árbol de levas (CMP).",
  "P0341": "Anomalía en comparación CKP/CMP detectada.",
  "P0400": "Mal funcionamiento del sistema de recirculación de gases de escape (EGR) – flujo insuficiente.",
  "P0401": "Flujo EGR insuficiente detectado.",
  "P0402": "Flujo EGR excesivo detectado.",
  "P0403": "Mal funcionamiento del circuito del sensor EGR.",
  "P0440": "Mal funcionamiento del sistema de control de emisiones evaporativas (EVAP).",
  "P0441": "Fuga del sistema EVAP detectada (fuga pequeña o intermedia).",
  "P0442": "Fuga pequeña del sistema EVAP detectada.",
  "P0443": "Circuito de control EVAP-VSV mal funcionando.",
  "P0444": "Circuito del sensor EVAP mal funcionamiento.",
  "P0446": "Mal funcionamiento del control del sistema EVAP.",
  "P0449": "Circuito VSV EVAP intermitente o rango/rendimiento fuera especificación.",
  "P0480": "Mal funcionamiento del circuito del controlador de ventilador de refrigeración.",
  "P0496": "Eficiencia del sistema de ventilador de refrigeración por debajo del umbral.",
  "P0500": "Sensor de velocidad del vehículo – mal funcionamiento del circuito.",
  "P0501": "Rango/rendimiento del sensor de velocidad del vehículo fuera de especificación.",
  "P0504": "Mal funcionamiento del circuito del sensor de corte del ralentí.",
  "P0505": "Relación rantalí – fuera de rango.",
  "P0507": "Vacío excesivo en el rantalí detectado.",
  "P0521": "Mal funcionamiento del circuito del sensor de presión de aceite.",
  "P0562": "Voltaje del sistema insuficiente (ECU principal).",
  "P0606": "Mal funcionamiento del microprocesador de ECM.",
  "P0700": "Mal funcionamiento genérico del control de la transmisión (TCM).",
  "P0705": "Interruptor de neutro/seguridad – mal funcionamiento del circuito.",
  "P0715": "Sensor de velocidad de entrada (transmisión) – circuito intermitente o mal funcionamiento.",
  "P0718": "Sensor de velocidad/turbina – circuito intermitente.",
  "P0720": "Sensor de velocidad de salida – mal funcionamiento del circuito.",
  "P0722": "Sensor de velocidad de salida – señal baja o rango fuera especificación.",
  "P0741": "Control de presión del convertidor (presión de torque) – rendimiento fuera de rango.",
  "P0753": "Interruptor/conjunto del cambio de la transmisión – posición intermitente o rango fuera especificación.",
  "P0046": "Mal funcionamiento del sistema de sobrealimentación / presión residual del turbo.",
  "P0093": "Fuga grande del sistema de combustible detectada.",
  "P0087": "Presión de rail de combustible  señal baja.",
  "P0088": "Presión de rail de combustible  señal alta.",
  "P0090": "Sensor de presión de combustible  mal funcionamiento del circuito.",
  "P0098": "Sensor de temperatura de aire de admisión 2  señal alta.",
  "P0110": "Mal funcionamiento del circuito del sensor de temperatura de aire de admisión.",
  "P0115": "Mal funcionamiento del circuito del sensor de temperatura del refrigerante del motor.",
  "P0117": "Sensor de temperatura del refrigerante  señal baja.",
  "P0191": "Sensor de presión de combustión  rango/performance fuera especificación.",
  "P0201-P0204": "Circuito del inyector de combustible  mal funcionamiento en cilindros 1 y4.",
  "P0222": "Sensor de posición del acelerador B  señal baja.",
  "P0223": "Sensor de posición del acelerador B – señal alta.",
  "P0238": "Sensor de presión turbo – rango/performance fuera especificación.",
  "P0315": "Valores del sistema de posición del cigüeñal no almacenados.",
  "P0320": "Mal funcionamiento en la señal de velocidad del distribuidor/encendido.",
  "P0336": "Sensor knock – bajo voltage (Banco 2).",
  "P0342": "Sensor CMP – señal baja o rango fuera especificación.",
  "P0351-P0354": "Bobina de encendido – mal funcionamiento del circuito (cilindros 1-4).",
  "P0380": "Circuito del calentador del sensor de posición del cigüeñal (CKP).",
  "P0410": "Sistema de aire secundario – mal funcionamiento.",
  "P0463": "Sensor de temperatura de combustible – señal fuera de rango.",
  "P0481": "Circuito de controlador del ventilador de refrigeración – intermitente.",
  "P0506": "Control de rantalí – rango fuera especificación.",
  "P0522": "Sensor de presión de aceite – rango/performance fuera especificación.",
  "P0603": "Mal funcionamiento en el circuito de memoria ECM.",
  "P0607": "Mal funcionamiento del circuito de ECT (temperatura de refrigerante).",
  "P0641": "Voltaje del sensor/calibración – línea baja.",
  "P0670": "Circuito del sensor de bujía incandescente – mal funcionamiento.",
  "P0683": "Circuito del relé de encendido (ECM/PCM) – mal funcionamiento.",
  "P0717": "Sensor de velocidad de entrada – rango/performance fuera especificación.",
  "P0722": "Sensor de velocidad de salida – señal baja/performance fuera especificación.",
  "P0730": "Relación de engranaje incorrecta.",
  "P0740": "Solenoide de control de torque – mal funcionamiento del circuito.",
  "P0753": "Switch cambio/transmisión mal intermitente.",
  "P0990": "Circuito del sistema de infoentretenimiento/diagnóstico extendido (vehicle-specific).",
   "U0001": "Red de alta velocidad CAN C personalizada 1",
  "U0002": "Red de alta velocidad CAN C personalizada 2",
  "U0003": "Red de alta velocidad CAN C personalizada 3",
  "U0004": "Red de alta velocidad CAN C personalizada 4",
  "U0005": "Red de alta velocidad CAN C personalizada 5",
  "U0006": "Red de alta velocidad CAN C personalizada 6",
  "U0007": "Red de alta velocidad CAN C personalizada 7",
  "U0008": "Red de alta velocidad CAN C personalizada 8",
  "U0009": "Red de alta velocidad CAN C personalizada 9",
  "U0010": "Red de alta velocidad CAN C personalizada 10",
  "U0011": "Red de alta velocidad CAN C personalizada 11",
  "U0012": "Red de alta velocidad CAN C personalizada 12",
  "U0013": "Red de alta velocidad CAN C personalizada 13",
  "U0014": "Red de alta velocidad CAN C personalizada 14",
  "U0015": "Red de alta velocidad CAN C personalizada 15",
  "U0016": "Red de alta velocidad CAN C personalizada 16",
  "U0017": "Red de alta velocidad CAN C personalizada 17",
  "U0018": "Red de alta velocidad CAN C personalizada 18",
  "U0019": "Red de alta velocidad CAN C personalizada 19",
  "U0020": "Red de alta velocidad CAN C personalizada 20",
  "U0021": "Red de alta velocidad CAN C personalizada 21",
  "U0022": "Red de alta velocidad CAN C personalizada 22",
  "U0023": "Red de alta velocidad CAN C personalizada 23",
  "U0024": "Red de alta velocidad CAN C personalizada 24",
  "U0025": "Red de alta velocidad CAN C personalizada 25",
  "U0026": "Red de alta velocidad CAN C personalizada 26",
  "U0027": "Red de alta velocidad CAN C personalizada 27",
  "U0028": "Red de alta velocidad CAN C personalizada 28",
  "U0029": "Red de alta velocidad CAN C personalizada 29",
  "U0030": "Red de alta velocidad CAN C personalizada 30",
  "U0031": "Comunicación con el módulo de control del motor 1",
  "U0032": "Comunicación con el módulo de control del motor 2",
  "U0033": "Comunicación con el módulo de control del motor 3",
  "U0034": "Comunicación con el módulo de control del motor 4",
  "U0035": "Comunicación con el módulo de control del motor 5",
  "U0036": "Comunicación con el módulo de control del motor 6",
  "U0037": "Comunicación con el módulo de control del motor 7",
  "U0038": "Comunicación con el módulo de control del motor 8",
  "U0039": "Comunicación con el módulo de control del motor 9",
  "U0040": "Comunicación con el módulo de control del motor 10",
  "U0041": "Comunicación con el módulo de control del motor 11",
  "U0042": "Comunicación con el módulo de control del motor 12",
  "U0043": "Comunicación con el módulo de control del motor 13",
  "U0044": "Comunicación con el módulo de control del motor 14",
  "U0045": "Comunicación con el módulo de control del motor 15",
  "U0046": "Comunicación con el módulo de control del motor 16",
  "U0047": "Comunicación con el módulo de control del motor 17",
  "U0048": "Comunicación con el módulo de control del motor 18",
  "U0049": "Comunicación con el módulo de control del motor 19",
  "U0050": "Comunicación con el módulo de control del motor 20",
  "U0051": "Comunicación con el módulo de control del motor 21",
  "U0052": "Comunicación con el módulo de control del motor 22",
  "U0053": "Comunicación con el módulo de control del motor 23",
  "U0054": "Comunicación con el módulo de control del motor 24",
  "U0055": "Comunicación con el módulo de control del motor 25",
  "U0056": "Comunicación con el módulo de control del motor 26",
  "U0057": "Comunicación con el módulo de control del motor 27",
  "U0058": "Comunicación con el módulo de control del motor 28",
  "U0059": "Comunicación con el módulo de control del motor 29",
  "U0060": "Comunicación con el módulo de control del motor 30",
  "U0061": "Error de comunicación con el módulo de control del motor 1",
  "U0062": "Error de comunicación con el módulo de control del motor 2",
  "U0063": "Error de comunicación con el módulo de control del motor 3",
  "U0064": "Error de comunicación con el módulo de control del motor 4",
  "U0065": "Error de comunicación con el módulo de control del motor 5",
  "U0066": "Error de comunicación con el módulo de control del motor 6",
  "U0067": "Error de comunicación con el módulo de control del motor 7",
  "U0068": "Error de comunicación con el módulo de control del motor 8",
  "U0069": "Error de comunicación con el módulo de control del motor 9",
  "U0070": "Error de comunicación con el módulo de control del motor 10",
  "U0071": "Error de comunicación con el módulo de control del motor 11",
  "U0072": "Error de comunicación con el módulo de control del motor 12",
  "U0073": "Error de comunicación con el módulo de control del motor 13",
  "U0074": "Error de comunicación con el módulo de control del motor 14",
  "U0075": "Error de comunicación con el módulo de control del motor 15",
  "U0076": "Error de comunicación con el módulo de control del motor 16",
  "U0077": "Error de comunicación con el módulo de control del motor 17",
  "U0078": "Error de comunicación con el módulo de control del motor 18",
  "U0079": "Error de comunicación con el módulo de control del motor 19",
  "U0080": "Error de comunicación con el módulo de control del motor 20",
  "U0081": "Error de comunicación con el módulo de control del motor 21",
  "U0082": "Error de comunicación con el módulo de control del motor 22",
  "U0083": "Error de comunicación con el módulo de control del motor 23",
  "U0084": "Error de comunicación con el módulo de control del motor 24",
  "U0085": "Error de comunicación con el módulo de control del motor 25",
  "U0086": "Error de comunicación con el módulo de control del motor 26",
  "U0087": "Error de comunicación con el módulo de control del motor 27",
  "U0088": "Error de comunicación con el módulo de control del motor 28",
  "U0089": "Error de comunicación con el módulo de control del motor 29",
  "U0090": "Error de comunicación con el módulo de control del motor 30",
  "U0091": "Error de comunicación con el módulo de control del motor 31",
  "U0092": "Error de comunicación con el módulo de control del motor 32",
  "U0093": "Error de comunicación con el módulo de control del motor 33",
  "U0094": "Error de comunicación con el módulo de control del motor 34",
  "U0095": "Error de comunicación con el módulo de control del motor 35",
  "U0096": "Error de comunicación con el módulo de control del motor 36",
  "U0097": "Error de comunicación con el módulo de control del motor 37",
  "U0098": "Error de comunicación con el módulo de control del motor 38",
  "U0099": "Error de comunicación con el módulo de control del motor 39",
  "U0100": "Fallo de comunicación con el módulo de control de la transmisión 1",
  "U0101": "Fallo de comunicación con el módulo de control de la transmisión 2",
  "U0102": "Fallo de comunicación con el módulo de control de la transmisión 3",
  "U0103": "Fallo de comunicación con el módulo de control de la transmisión 4",
  "U0104": "Fallo de comunicación con el módulo de control de la transmisión 5",
  "U0106": "Fallo de comunicación con el módulo de control de la transmisión 7",
  "U0107": "Fallo de comunicación con el módulo de control de la transmisión 8",
  "U0108": "Fallo de comunicación con el módulo de control de la transmisión 9",
  "U0109": "Fallo de comunicación con el módulo de control de la transmisión 10",
  "U0110": "Fallo de comunicación con el módulo de control de la transmisión 11",
  "U0111": "Fallo de comunicación con el módulo de control de la transmisión 12",
  "U0112": "Fallo de comunicación con el módulo de control de la transmisión 13",
  "U0113": "Fallo de comunicación con el módulo de control de la transmisión 14",
  "U0114": "Fallo de comunicación con el módulo de control de la transmisión 15",
  "U0115": "Fallo de comunicación con el módulo de control de la transmisión 16",
  "U0116": "Fallo de comunicación con el módulo de control de la transmisión 17",
  "U0117": "Fallo de comunicación con el módulo de control de la transmisión 18",
  "U0118": "Fallo de comunicación con el módulo de control de la transmisión 19",
  "U0119": "Fallo de comunicación con el módulo de control de la transmisión 20",
  "U0120": "Fallo de comunicación con el módulo de control de la transmisión 21",
  "U0121": "Fallo de comunicación con el módulo de control de la transmisión 22",
  "U0122": "Fallo de comunicación con el módulo de control de la transmisión 23",
  "U0123": "Fallo de comunicación con el módulo de control de la transmisión 24",
  "U0124": "Fallo de comunicación con el módulo de control de la transmisión 25",
  "U0125": "Fallo de comunicación con el módulo de control de la transmisión 26",
  "U0126": "Fallo de comunicación con el módulo de control de la transmisión 27",
  "U0127": "Fallo de comunicación con el módulo de control de la transmisión 28",
  "U0128": "Fallo de comunicación con el módulo de control de la transmisión 29",
  "U0129": "Fallo de comunicación con el módulo de control de la transmisión 30",
  "U0130": "Fallo de comunicación con el módulo de control de la transmisión 31",
  "U0131": "Fallo de comunicación con el módulo de control de la transmisión 32",
  "U0132": "Fallo de comunicación con el módulo de control de la transmisión 33",
  "U0133": "Fallo de comunicación con el módulo de control de la transmisión 34",
  "U0134": "Fallo de comunicación con el módulo de control de la transmisión 35",
  "U0135": "Fallo de comunicación con el módulo de control de la transmisión 36",
  "U0136": "Fallo de comunicación con el módulo de control de la transmisión 37",
  "U0137": "Fallo de comunicación con el módulo de control de la transmisión 38",
  "U0138": "Fallo de comunicación con el módulo de control de la transmisión 39",
  "U0139": "Fallo de comunicación con el módulo de control de la transmisión 40",
  "U0140": "Fallo de comunicación con el módulo de control de la transmisión 41",
  "U0141": "Fallo de comunicación con el módulo de control de la transmisión 42",
  "U0142": "Fallo de comunicación con el módulo de control de la transmisión 43",
  "U0143": "Fallo de comunicación con el módulo de control de la transmisión 44",
  "U0144": "Fallo de comunicación con el módulo de control de la transmisión 45",
  "U0145": "Fallo de comunicación con el módulo de control de la transmisión 46",
  "U0146": "Fallo de comunicación con el módulo de control de la transmisión 47",
  "U0147": "Fallo de comunicación con el módulo de control de la transmisión 48",
  "U0148": "Fallo de comunicación con el módulo de control de la transmisión 49",
  "U0149": "Fallo de comunicación con el módulo de control de la transmisión 50",
  "U0150": "Fallo de comunicación con el módulo de control de la transmisión 51",
  "U0151": "Fallo de comunicación con el módulo de control de la transmisión 52",
  "U0152": "Fallo de comunicación con el módulo de control de la transmisión 53",
  "U0153": "Fallo de comunicación con el módulo de control de la transmisión 54",
  "U0154": "Fallo de comunicación con el módulo de control de la transmisión 55",
  "U0155": "Fallo de comunicación con el módulo de control de la transmisión 56",
  "U0156": "Fallo de comunicación con el módulo de control de la transmisión 57",
  "U0157": "Fallo de comunicación con el módulo de control de la transmisión 58",
  "U0158": "Fallo de comunicación con el módulo de control de la transmisión 59",
  "U0159": "Fallo de comunicación con el módulo de control de la transmisión 60",
  "U0160": "Fallo de comunicación con el módulo de control de la transmisión 61",
  "U0161": "Fallo de comunicación con el módulo de control de la transmisión 62",
  "U0162": "Fallo de comunicación con el módulo de control de la transmisión 63",
  "U0163": "Fallo de comunicación con el módulo de control de la transmisión 64",
  "U0164": "Fallo de comunicación con el módulo de control de la transmisión 65",
  "U0165": "Fallo de comunicación con el módulo de control de la transmisión 66",
  "U0166": "Fallo de comunicación con el módulo de control de la transmisión 67",
  "U0167": "Fallo de comunicación con el módulo de control de la transmisión 68",
  "U0168": "Fallo de comunicación con el módulo de control de la transmisión 69",
  "U0169": "Fallo de comunicación con el módulo de control de la transmisión 70",
  "U0170": "Fallo de comunicación con el módulo de control de la transmisión 71",
  "U0171": "Fallo de comunicación con el módulo de control de la transmisión 72",
  "U0172": "Fallo de comunicación con el módulo de control de la transmisión 73",
  "U0173": "Fallo de comunicación con el módulo de control de la transmisión 74",
  "U0174": "Fallo de comunicación con el módulo de control de la transmisión 75",
  "U0175": "Fallo de comunicación con el módulo de control de la transmisión 76",
  "U0176": "Fallo de comunicación con el módulo de control de la transmisión 77",
  "U0177": "Fallo de comunicación con el módulo de control de la transmisión 78",
  "U0178": "Fallo de comunicación con el módulo de control de la transmisión 79",
  "U0179": "Fallo de comunicación con el módulo de control de la transmisión 80",
  "U0180": "Fallo de comunicación con el módulo de control de la transmisión 81",
  "U0181": "Fallo de comunicación con el módulo de control de la transmisión 82",
  "U0182": "Fallo de comunicación con el módulo de control de la transmisión 83",
  "U0183": "Fallo de comunicación con el módulo de control de la transmisión 84",
  "U0184": "Fallo de comunicación con el módulo de control de la transmisión 85",
  "U0185": "Fallo de comunicación con el módulo de control de la transmisión 86",
  "U0186": "Fallo de comunicación con el módulo de control de la transmisión 87",
  "U0187": "Fallo de comunicación con el módulo de control de la transmisión 88",
  "U0188": "Fallo de comunicación con el módulo de control de la transmisión 89",
  "U0189": "Fallo de comunicación con el módulo de control de la transmisión 90",
  "U0190": "Fallo de comunicación con el módulo de control de la transmisión 91",
  "U0191": "Fallo de comunicación con el módulo de control de la transmisión 92",
  "U0192": "Fallo de comunicación con el módulo de control de la transmisión 93",
  "U0193": "Fallo de comunicación con el módulo de control de la transmisión 94",
  "U0194": "Fallo de comunicación con el módulo de control de la transmisión 95",
  "U0195": "Fallo de comunicación con el módulo de control de la transmisión 96",
  "U0196": "Fallo de comunicación con el módulo de control de la transmisión 97",
  "U0197": "Fallo de comunicación con el módulo de control de la transmisión 98",
  "U0198": "Fallo de comunicación con el módulo de control de la transmisión 99",
  "U0199": "Fallo de comunicación con el módulo de control de la transmisión 100",
  "U0200": "Fallo de comunicación con el módulo de control de transmisión 1",
  "U0201": "Fallo de comunicación con el módulo de control de transmisión 2",
  "U0202": "Fallo de comunicación con el módulo de control de transmisión 3",
  "U0203": "Fallo de comunicación con el módulo de control de transmisión 4",
  "U0204": "Fallo de comunicación con el módulo de control de transmisión 5",
  "U0205": "Fallo de comunicación con el módulo de control de transmisión 6",
  "U0206": "Fallo de comunicación con el módulo de control de transmisión 7",
  "U0207": "Fallo de comunicación con el módulo de control de transmisión 8",
  "U0208": "Fallo de comunicación con el módulo de control de transmisión 9",
  "U0209": "Fallo de comunicación con el módulo de control de transmisión 10",
  "U0210": "Fallo de comunicación con el módulo de control de transmisión 11",
  "U0211": "Fallo de comunicación con el módulo de control de transmisión 12",
  "U0212": "Fallo de comunicación con el módulo de control de transmisión 13",
  "U0213": "Fallo de comunicación con el módulo de control de transmisión 14",
  "U0214": "Fallo de comunicación con el módulo de control de transmisión 15",
  "U0215": "Fallo de comunicación con el módulo de control de transmisión 16",
  "U0216": "Fallo de comunicación con el módulo de control de transmisión 17",
  "U0217": "Fallo de comunicación con el módulo de control de transmisión 18",
  "U0218": "Fallo de comunicación con el módulo de control de transmisión 19",
  "U0219": "Fallo de comunicación con el módulo de control de transmisión 20",
  "U0220": "Fallo de comunicación con el módulo de control de transmisión 21",
  "U0221": "Fallo de comunicación con el módulo de control de transmisión 22",
  "U0222": "Fallo de comunicación con el módulo de control de transmisión 23",
  "U0223": "Fallo de comunicación con el módulo de control de transmisión 24",
  "U0224": "Fallo de comunicación con el módulo de control de transmisión 25",
  "U0225": "Fallo de comunicación con el módulo de control de transmisión 26",
  "U0226": "Fallo de comunicación con el módulo de control de transmisión 27",
  "U0227": "Fallo de comunicación con el módulo de control de transmisión 28",
  "U0228": "Fallo de comunicación con el módulo de control de transmisión 29",
  "U0229": "Fallo de comunicación con el módulo de control de transmisión 30",
  "U0230": "Fallo de comunicación con el módulo de control de transmisión 31",
  "U0231": "Fallo de comunicación con el módulo de control de transmisión 32",
  "U0232": "Fallo de comunicación con el módulo de control de transmisión 33",
  "U0233": "Fallo de comunicación con el módulo de control de transmisión 34",
  "U0234": "Fallo de comunicación con el módulo de control de transmisión 35",
  "U0235": "Fallo de comunicación con el módulo de control de transmisión 36",
  "U0236": "Fallo de comunicación con el módulo de control de transmisión 37",
  "U0237": "Fallo de comunicación con el módulo de control de transmisión 38",
  "U0238": "Fallo de comunicación con el módulo de control de transmisión 39",
  "U0239": "Fallo de comunicación con el módulo de control de transmisión 40",
  "U0240": "Fallo de comunicación con el módulo de control de transmisión 41",
  "U0241": "Fallo de comunicación con el módulo de control de transmisión 42",
  "U0242": "Fallo de comunicación con el módulo de control de transmisión 43",
  "U0243": "Fallo de comunicación con el módulo de control de transmisión 44",
  "U0244": "Fallo de comunicación con el módulo de control de transmisión 45",
  "U0245": "Fallo de comunicación con el módulo de control de transmisión 46",
  "U0246": "Fallo de comunicación con el módulo de control de transmisión 47",
  "U0247": "Fallo de comunicación con el módulo de control de transmisión 48",
  "U0248": "Fallo de comunicación con el módulo de control de transmisión 49",
  "U0249": "Fallo de comunicación con el módulo de control de transmisión 50",
  "U0250": "Fallo de comunicación con el módulo de control de transmisión 51",
  "U0251": "Fallo de comunicación con el módulo de control de transmisión 52",
  "U0252": "Fallo de comunicación con el módulo de control de transmisión 53",
  "U0253": "Fallo de comunicación con el módulo de control de transmisión 54",
  "U0254": "Fallo de comunicación con el módulo de control de transmisión 55",
  "U0255": "Fallo de comunicación con el módulo de control de transmisión 56",
  "U0256": "Fallo de comunicación con el módulo de control de transmisión 57",
  "U0257": "Fallo de comunicación con el módulo de control de transmisión 58",
  "U0258": "Fallo de comunicación con el módulo de control de transmisión 59",
  "U0259": "Fallo de comunicación con el módulo de control de transmisión 60",
  "U0260": "Fallo de comunicación con el módulo de control de transmisión 61",
  "U0261": "Fallo de comunicación con el módulo de control de transmisión 62",
  "U0262": "Fallo de comunicación con el módulo de control de transmisión 63",
  "U0263": "Fallo de comunicación con el módulo de control de transmisión 64",
  "U0264": "Fallo de comunicación con el módulo de control de transmisión 65",
  "U0265": "Fallo de comunicación con el módulo de control de transmisión 66",
  "U0266": "Fallo de comunicación con el módulo de control de transmisión 67",
  "U0267": "Fallo de comunicación con el módulo de control de transmisión 68",
  "U0268": "Fallo de comunicación con el módulo de control de transmisión 69",
  "U0269": "Fallo de comunicación con el módulo de control de transmisión 70",
  "U0270": "Fallo de comunicación con el módulo de control de transmisión 71",
  "U0271": "Fallo de comunicación con el módulo de control de transmisión 72",
  "U0272": "Fallo de comunicación con el módulo de control de transmisión 73",
  "U0273": "Fallo de comunicación con el módulo de control de transmisión 74",
  "U0274": "Fallo de comunicación con el módulo de control de transmisión 75",
  "U0275": "Fallo de comunicación con el módulo de control de transmisión 76",
  "U0276": "Fallo de comunicación con el módulo de control de transmisión 77",
  "U0277": "Fallo de comunicación con el módulo de control de transmisión 78",
  "U0278": "Fallo de comunicación con el módulo de control de transmisión 79",
  "U0279": "Fallo de comunicación con el módulo de control de transmisión 80",
  "U0280": "Fallo de comunicación con el módulo de control de transmisión 81",
  "U0281": "Fallo de comunicación con el módulo de control de transmisión 82",
  "U0282": "Fallo de comunicación con el módulo de control de transmisión 83",
  "U0283": "Fallo de comunicación con el módulo de control de transmisión 84",
  "U0284": "Fallo de comunicación con el módulo de control de transmisión 85",
  "U0285": "Fallo de comunicación con el módulo de control de transmisión 86",
  "U0286": "Fallo de comunicación con el módulo de control de transmisión 87",
  "U0287": "Fallo de comunicación con el módulo de control de transmisión 88",
  "U0288": "Fallo de comunicación con el módulo de control de transmisión 89",
  "U0289": "Fallo de comunicación con el módulo de control de transmisión 90",
  "U0290": "Fallo de comunicación con el módulo de control de transmisión 91",
  "U0291": "Fallo de comunicación con el módulo de control de transmisión 92",
  "U0292": "Fallo de comunicación con el módulo de control de transmisión 93",
  "U0293": "Fallo de comunicación con el módulo de control de transmisión 94",
  "U0294": "Fallo de comunicación con el módulo de control de transmisión 95",
  "U0295": "Fallo de comunicación con el módulo de control de transmisión 96",
  "U0296": "Fallo de comunicación con el módulo de control de transmisión 97",
  "U0297": "Fallo de comunicación con el módulo de control de transmisión 98",
  "U0298": "Fallo de comunicación con el módulo de control de transmisión 99",
  "U0299": "Fallo de comunicación con el módulo de control de transmisión 100",
  "U0300": "Fallo en la comunicación con el módulo de control general 1",
  "U0301": "Fallo en la comunicación con el módulo de control general 2",
  "U0302": "Fallo en la comunicación con el módulo de control general 3",
  "U0303": "Fallo en la comunicación con el módulo de control general 4",
  "U0304": "Fallo en la comunicación con el módulo de control general 5",
  "U0306": "Fallo en la comunicación con el módulo de control general 6",
  "U0307": "Fallo en la comunicación con el módulo de control general 7",
  "U0308": "Fallo en la comunicación con el módulo de control general 8",
  "U0309": "Fallo en la comunicación con el módulo de control general 9",
  "U0310": "Fallo en la comunicación con el módulo de control general 10",
  "U0311": "Fallo en la comunicación con el módulo de control general 11",
  "U0312": "Fallo en la comunicación con el módulo de control general 12",
  "U0313": "Fallo en la comunicación con el módulo de control general 13",
  "U0314": "Fallo en la comunicación con el módulo de control general 14",
  "U0315": "Fallo en la comunicación con el módulo de control general 15",
  "U0316": "Fallo en la comunicación con el módulo de control general 16",
  "U0317": "Fallo en la comunicación con el módulo de control general 17",
  "U0318": "Fallo en la comunicación con el módulo de control general 18",
  "U0319": "Fallo en la comunicación con el módulo de control general 19",
  "U0320": "Fallo en la comunicación con el módulo de control general 20",
  "U0321": "Fallo en la comunicación con el módulo de control general 21",
  "U0322": "Fallo en la comunicación con el módulo de control general 22",
  "U0323": "Fallo en la comunicación con el módulo de control general 23",
  "U0324": "Fallo en la comunicación con el módulo de control general 24",
  "U0325": "Fallo en la comunicación con el módulo de control general 25",
  "U0326": "Fallo en la comunicación con el módulo de control general 26",
  "U0327": "Fallo en la comunicación con el módulo de control general 27",
  "U0328": "Fallo en la comunicación con el módulo de control general 28",
  "U0329": "Fallo en la comunicación con el módulo de control general 29",
  "U0330": "Fallo en la comunicación con el módulo de control general 30",
  "U0400": "Fallo de comunicación con el módulo de control de tracción 1",
  "U0401": "Fallo de comunicación con el módulo de control de tracción 2",
  "U0402": "Fallo de comunicación con el módulo de control de tracción 3",
  "U0403": "Fallo de comunicación con el módulo de control de tracción 4",
  "U0404": "Fallo de comunicación con el módulo de control de tracción 5",
  "U0405": "Fallo de comunicación con el módulo de control de tracción 6",
  "U0406": "Fallo de comunicación con el módulo de control de tracción 7",
  "U0407": "Fallo de comunicación con el módulo de control de tracción 8",
  "U0408": "Fallo de comunicación con el módulo de control de tracción 9",
  "U0409": "Fallo de comunicación con el módulo de control de tracción 10",
  "U0410": "Fallo de comunicación con el módulo de control de tracción 11",
  "U0411": "Fallo de comunicación con el módulo de control de tracción 12",
  "U0412": "Fallo de comunicación con el módulo de control de tracción 13",
  "U0413": "Fallo de comunicación con el módulo de control de tracción 14",
  "U0414": "Fallo de comunicación con el módulo de control de tracción 15",
  "U0415": "Fallo de comunicación con el módulo de control de tracción 16",
  "U0416": "Fallo de comunicación con el módulo de control de tracción 17",
  "U0418": "Fallo de comunicación con el módulo de control de tracción 18",
  "U0419": "Fallo de comunicación con el módulo de control de tracción 19",
  "U0420": "Fallo de comunicación con el módulo de control de tracción 20",
  "U0421": "Fallo de comunicación con el módulo de control de tracción 21",
  "U0422": "Fallo de comunicación con el módulo de control de tracción 22",
  "U0423": "Fallo de comunicación con el módulo de control de tracción 23",
  "U0424": "Fallo de comunicación con el módulo de control de tracción 24",
  "U0425": "Fallo de comunicación con el módulo de control de tracción 25",
  "U0426": "Fallo de comunicación con el módulo de control de tracción 26",
  "U0427": "Fallo de comunicación con el módulo de control de tracción 27",
  "U0428": "Fallo de comunicación con el módulo de control de tracción 28",
  "U0429": "Fallo de comunicación con el módulo de control de tracción 29",
  "U0430": "Fallo de comunicación con el módulo de control de tracción 30",
  "U0431": "Fallo de comunicación con el módulo de control de tracción 31",
   "C0050": "Circuito del sensor de velocidad del vehículo",
  "C0110": "Circuito de tensión de la batería bajo",
  "C0131": "Circuito de freno de estacionamiento",
  "C0182": "Circuito del sensor de posición del árbol de levas B 147",
  "C0226": "Circuito del sensor de posición del árbol de levas B 191",
  "C0281": "Circuito de freno de servicio",
  "C0300": "Fallo de encendido aleatorio detectado",
  "C0455": "Sistema de control de tracción (TCS) desactivado",
  "C0561": "Control de velocidad no permitido por el ECM",
  "C0896": "Relé de interruptor de circuito de velocidad de crucero",
  "C0111": "Sensor de nivel de aceite bajo",
  "C0121": "Circuito del interruptor de luz de freno",
  "C0161": "Circuito del sensor de posición del árbol de levas B 126",
  "C0222": "Circuito del sensor de posición del árbol de levas B 187",
  "C0223": "Circuito del sensor de posición del árbol de levas B 188",
  "C0224": "Circuito del sensor de posición del árbol de levas B 189",
  "C0225": "Circuito del sensor de posición del árbol de levas B 190",
  "C0231": "Módulo de control del ABS de la rueda delantera izquierda",
  "C0232": "Módulo de control del ABS de la rueda delantera derecha",
  "C0233": "Módulo de control del ABS de la rueda trasera izquierda",
  "C0234": "Módulo de control del ABS de la rueda trasera derecha",
  "C0235": "Error de dirección asistida",
  "C0241": "Error de velocidad de la bomba de dirección asistida",
  "C0242": "Mal funcionamiento de la válvula solenoide de cambio en frío",
  "C0251": "Control de la posición de la válvula solenoide",
  "C0252": "Solenoide de control de la válvula de purga del evaporador",
  "C0253": "Mal funcionamiento del solenoide de la válvula de purga",
  "C0254": "Mal funcionamiento de la válvula de ventilación del tanque de combustible",
  "C0255": "Circuito de la válvula de ventilación del tanque de combustible",
  "C0261": "Circuito del actuador de embrague hidráulico",
  "C0262": "Mal funcionamiento del actuador de embrague hidráulico",
  "C0162": "Circuito del sensor de posición del árbol de levas B 127",
  "C0163": "Circuito del sensor de posición del árbol de levas B 128",
  "C0164": "Circuito del sensor de posición del árbol de levas B 129",
  "C0165": "Circuito del sensor de posición del árbol de levas B 130",
  "C0166": "Circuito del sensor de posición del árbol de levas B 131",
  "C0167": "Circuito del sensor de posición del árbol de levas B 132",
  "C0168": "Circuito del sensor de posición del árbol de levas B 133",
  "C0169": "Circuito del sensor de posición del árbol de levas B 134",
  "C0170": "Circuito del sensor de posición del árbol de levas B 135",
  "C0171": "Circuito del sensor de posición del árbol de levas B 136",
  "C0172": "Circuito del sensor de posición del árbol de levas B 137",
  "C0173": "Circuito del sensor de posición del árbol de levas B 138",
  "C0174": "Circuito del sensor de posición del árbol de levas B 139",
  "C0175": "Circuito del sensor de posición del árbol de levas B 140",
  "C0176": "Circuito del sensor de posición del árbol de levas B 141",
  "C0177": "Circuito del sensor de posición del árbol de levas B 142",
  "C0178": "Circuito del sensor de posición del árbol de levas B 143",
  "C0179": "Circuito del sensor de posición del árbol de levas B 144",
  "C0180": "Circuito del sensor de posición del árbol de levas B 145",
  "C0181": "Circuito del sensor de posición del árbol de levas B 146",
  "C0183": "Circuito del sensor de posición del árbol de levas B 148",
  "C0184": "Circuito del sensor de posición del árbol de levas B 149",
  "C0185": "Circuito del sensor de posición del árbol de levas B 150",
  "C0186": "Circuito del sensor de posición del árbol de levas B 151",
  "C0187": "Circuito del sensor de posición del árbol de levas B 152",
  "C0188": "Circuito del sensor de posición del árbol de levas B 153",
  "C0189": "Circuito del sensor de posición del árbol de levas B 154",
  "C0190": "Circuito del sensor de posición del árbol de levas B 155",
  "C0191": "Circuito del sensor de posición del árbol de levas B 156",
  "C0192": "Circuito del sensor de posición del árbol de levas B 157",
  "C0193": "Circuito del sensor de posición del árbol de levas B 158",
  "C0194": "Circuito del sensor de posición del árbol de levas B 159",
  "C0195": "Circuito del sensor de posición del árbol de levas B 160",
  "C0196": "Circuito del sensor de posición del árbol de levas B 161",
  "C0197": "Circuito del sensor de posición del árbol de levas B 162",
  "C0198": "Circuito del sensor de posición del árbol de levas B 163",
  "C0199": "Circuito del sensor de posición del árbol de levas B 164",
  "C0200": "Circuito del sensor de posición del árbol de levas B 165",
  "C0201": "Circuito del sensor de posición del árbol de levas B 166",
  "C0202": "Circuito del sensor de posición del árbol de levas B 167",
  "C0203": "Circuito del sensor de posición del árbol de levas B 168",
  "C0204": "Circuito del sensor de posición del árbol de levas B 169",
  "C0205": "Circuito del sensor de posición del árbol de levas B 170",
  "C0206": "Circuito del sensor de posición del árbol de levas B 171",
  "C0207": "Circuito del sensor de posición del árbol de levas B 172",
  "C0208": "Circuito del sensor de posición del árbol de levas B 173",
  "C0209": "Circuito del sensor de posición del árbol de levas B 174",
  "C0210": "Circuito del sensor de posición del árbol de levas B 175",
  "C0211": "Circuito del sensor de posición del árbol de levas B 176",
  "C0212": "Circuito del sensor de posición del árbol de levas B 177",
  "C0213": "Circuito del sensor de posición del árbol de levas B 178",
  "C0214": "Circuito del sensor de posición del árbol de levas B 179",
  "C0215": "Circuito del sensor de posición del árbol de levas B 180",
  "C0216": "Circuito del sensor de posición del árbol de levas B 181",
  "C0217": "Circuito del sensor de posición del árbol de levas B 182",
  "C0218": "Circuito del sensor de posición del árbol de levas B 183",
  "C0219": "Circuito del sensor de posición del árbol de levas B 184",
  "C0220": "Circuito del sensor de posición del árbol de levas B 185",
  "C0221": "Circuito del sensor de posición del árbol de levas B 186",
  "C0227": "Circuito del sensor de posición del árbol de levas B 192",
  "C0228": "Circuito del sensor de posición del árbol de levas B 193",
  "C0229": "Circuito del sensor de posición del árbol de levas B 194",
  "C0230": "Circuito del sensor de posición del árbol de levas B 195",
  "C0040": "Fallo en el circuito de velocidad de la rueda delantera derecha"
    };

    const txtCodigos = document.getElementById("codigo_area");
    const txtDetalle = document.getElementById("detalle_area");
    const RE_CODIGO = /^[PBCU]\d{4}$/;
    const normalizar = s => s.toUpperCase().trim().replace(/[^A-Z0-9]/g, "");
    const codigosDe = (input) => Array.from(new Set(
      input.toUpperCase().split(/[\s,;]+/).map(normalizar).filter(c => RE_CODIGO.test(c))
    ));
    const esLineaAuto = (l) => /^•\s+.+/.test(l.trim()) && !/^[PBCU]\d{4}/.test(l.trim());
    const construirLineasAutoSoloDescripcion = (codigos) => codigos.filter(c => CODIGOS_BASE[c]).map(c => `• ${CODIGOS_BASE[c]}`);

    function mezclarDetalleSoloDescripcion() {
      const cods = codigosDe(txtCodigos.value);
      const nuevasAuto = construirLineasAutoSoloDescripcion(cods);
      const lineas = txtDetalle.value.split(/\r?\n/);
      const manual = lineas.filter(l => !esLineaAuto(l) && l.trim() !== "");
      txtDetalle.value = nuevasAuto.length ? [...nuevasAuto, ...(manual.length?["",...manual]:[])].join("\n") : manual.join("\n");
    }
    txtCodigos.addEventListener("input", () => {
      clearTimeout(window.__debAutoTimer);
      window.__debAutoTimer = setTimeout(mezclarDetalleSoloDescripcion, 120);
    });
  </script>

  <!-- ====== Guardar en Sheets + Borrar + Atajos + Auto-grow + Recolectar datos ====== -->
  <script>
    async function guardarEnGoogleSheetsYImprimir() {
      const datos = recogerDatosInforme();
      try {
        await fetch("https://script.google.com/macros/s/AKfycbzTDTkFKdwIqH8E_jDrOWx3chf42XasN-QI0WcCRav9gS9r7gZJ5tRIVVch1T6E1ukw/exec", {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(datos)
        });
        window.print();
      } catch (e) {
        alert("⚠️ No se pudo guardar en Google Sheets. Se abrirá la impresión de todos modos.");
        window.print();
      }
    }

    function borrarTodo() {
      if (!confirm("¿Seguro que quieres borrar todo el contenido del informe?")) return;
      document.querySelectorAll('input[type="text"], textarea').forEach(el => el.value = '');
      mezclarDetalleSoloDescripcion();
    }

    document.addEventListener("keydown", (ev) => {
      if (ev.ctrlKey && ev.shiftKey && (ev.key === 'S' || ev.key === 's')) { ev.preventDefault(); guardarEnGoogleSheetsYImprimir(); }
      if (ev.ctrlKey && ev.shiftKey && (ev.key === 'D' || ev.key === 'd')) { ev.preventDefault(); borrarTodo(); }
      if (ev.ctrlKey && (ev.key === 'l' || ev.key === 'L')) { ev.preventDefault(); localStorage.removeItem('auth_until_ts'); sessionStorage.removeItem('auth_until_ts'); location.reload(); }
    });

    (function(){ ['codigo_area','detalle_area'].forEach(id=>{
      const el = document.getElementById(id);
      function fit(){ el.style.height='auto'; el.style.height=(el.scrollHeight+2)+'px'; }
      if(el){ fit(); el.addEventListener('input', fit); }
    }); })();

    function recogerDatosInforme(){
      return {
        marca: document.querySelector('input[name="marca"]').value.trim(),
        modelo: document.querySelector('input[name="modelo"]').value.trim(),
        patente: document.querySelector('input[name="patente"]').value.trim().toUpperCase(),
        ano: document.querySelector('input[name="ano"]').value.trim(),
        km: document.querySelector('input[name="km"]').value.trim(),
        motor: document.querySelector('input[name="motor"]').value.trim(),
        codigo: document.getElementById("codigo_area").value.trim(),
        detalle: document.getElementById("detalle_area").value.trim(),
        valor_area: document.getElementById("valor_area").value.trim(),
        causas: document.getElementById("causas").value.trim(),
        recomendaciones: document.getElementById("recomendaciones").value.trim(),
        valor_final: document.getElementById("valor_final").value.trim(),
        fecha: document.getElementById("fecha").innerText.trim()
      };
    }
  </script>

  <!-- ====== Librerías: QR / compresión / PDF local ====== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" referrerpolicy="no-referrer"></script>

  <!-- ====== Modal QR ====== -->
  <div id="qr-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); align-items:center; justify-content:center; z-index:99998;">
    <div style="background:#fff; width:min(92vw,420px); border:1px solid #000; border-radius:10px; padding:18px; box-shadow:0 4px 0 #000; text-align:center;">
      <h3 style="margin:0 0 10px">Escanea para descargar el PDF</h3>
      <div id="qr-box" style="display:flex; justify-content:center; margin:10px 0;"></div>
      <div style="word-break:break-all; font-size:12px; margin:8px 0;"><a id="qr-link" href="#" target="_blank" rel="noopener"></a></div>
      <div style="display:flex; gap:8px; justify-content:center; margin-top:8px;">
        <button onclick="navigator.clipboard.writeText(document.getElementById('qr-link').href)">Copiar link</button>
        <button onclick="document.getElementById('qr-modal').style.display='none'">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ====== Botonera flotante ====== -->
  <div class="fab">
    <button onclick="guardarEnGoogleSheetsYImprimir()" class="boton-imprimir">🖨️ Imprimir y Guardar</button>
    <button onclick="descargarPDFLocal()" class="boton-pdf">📄 Descargar PDF</button>
    <button onclick="generarQRDeDescargaPDF()" class="boton-qr">📲 Mostrar QR</button>
    <button onclick="buscarAplicacion()" class="boton-buscar-aplicacion">🔍 Buscar aplicación</button>
    <button onclick="borrarTodo()" class="boton-borrar">🧹 Borrar todo</button>
  </div>

  <!-- ====== Lógica QR + Descarga PDF local ====== -->
  <script>
    function construirLinkDescarga(datos){
      const packed = LZString.compressToEncodedURIComponent(JSON.stringify(datos));
      const base = location.href.substring(0, location.href.lastIndexOf('/') + 1);
      return base + 'informe_dl.html#' + packed;
    }

    function mostrarQr(url){
      const link = document.getElementById('qr-link');
      const box = document.getElementById('qr-box');
      link.textContent = url; link.href = url; box.innerHTML = "";
      new QRCode(box, { text: url, width: 220, height: 220 });
      document.getElementById('qr-modal').style.display = 'flex';
    }

    function generarQRDeDescargaPDF(){
      mostrarQr(construirLinkDescarga(recogerDatosInforme()));
    }

    // Espera a que las imágenes del papel estén listas (evita que falten en el PDF)
    function waitImagesLoaded(container){
      const imgs = Array.from(container.querySelectorAll('img'));
      if (!imgs.length) return Promise.resolve();
      return Promise.all(imgs.map(img => img.complete ? Promise.resolve() :
        new Promise(res => { img.onload = res; img.onerror = res; })));
    }

    async function descargarPDFLocal(){
      const paper = document.getElementById('paper');
      const fab = document.querySelector('.fab');
      const prev = fab.style.display; fab.style.display = 'none'; // no exportar botones
      await waitImagesLoaded(paper);

      const patente = (document.querySelector('input[name="patente"]').value || 'SIN_PATENTE')
                      .toUpperCase().replace(/\s+/g,'');
      const opt = {
        filename: `Informe_${patente}_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.pdf`,
        margin: 0,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'letter', orientation: 'portrait' }
      };
      try{
        await html2pdf().set(opt).from(paper).save();
      } finally {
        fab.style.display = prev || '';
      }
    }
  </script>
</body>
</html>
