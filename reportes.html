<!DOCTYPE html>
<html lang="es-CL">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reportes Â· Aceite</title>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0b0b0c;color:#e9ecef;}
    .topbar{background:#000;color:#fff;text-align:center;padding:14px;border-bottom:4px solid #900000;}
    .wrap{max-width:900px;margin:24px auto;padding:0 16px;}
    .card{background:#0f0f11;border:3px solid #900000;border-radius:16px;padding:18px;margin-bottom:16px;
          box-shadow:0 10px 28px rgba(0,0,0,.45);}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{border:1px solid #900000;padding:8px;text-align:center;}
    th{background:#900000;color:#fff;}
    .btn{background:#0c0c0e;color:#fff;border:2px solid #900000;border-radius:12px;padding:10px 14px;
         text-decoration:none;font-weight:800;cursor:pointer;transition:.2s;}
    .btn:hover{background:#900000;}
  </style>
</head>
<body>
  <div class="topbar">ðŸ“Š Reporte de Ventas</div>
  <div class="wrap">
    <a href="aceite.html" class="btn">â¬… Volver al panel</a>
    <button id="btnGen" class="btn">Generar reporte</button>

    <div id="resumen" class="card" style="display:none"></div>
    <div id="tabla" class="card" style="display:none"></div>
  </div>

<script type="module">
const BASE_URL = "https://script.google.com/macros/s/AKfycbx2y_JLxDmrfAwyJMKH5mVVDN1rQPZpx95OBXLOexFrLYdz9-vxFKKktjO1-2r2IM2b-g/exec"; // ðŸ‘ˆ tu mismo endpoint
const api = async (action,payload={})=>{
  const res = await fetch(BASE_URL,{
    method:"POST",
    headers:{'Content-Type':'text/plain;charset=utf-8'},
    body: JSON.stringify({action,payload})
  });
  return res.json();
};

const $=id=>document.getElementById(id);

$('btnGen').addEventListener('click',async()=>{
  $('btnGen').disabled=true;
  const r=await api('generateReport');
  $('btnGen').disabled=false;

  if(!r.ok) return alert('Error al generar reporte: '+r.error);
  $('resumen').style.display='block';
  $('tabla').style.display='block';

  $('resumen').innerHTML=`
    <h2>ðŸ“… Reporte Mensual (${r.periodo})</h2>
    <p><b>Total Ventas:</b> ${r.totalVentas.toLocaleString('es-CL')}</p>
    <p><b>Total Utilidad:</b> ${r.totalUtilidad.toLocaleString('es-CL')}</p>
    <p><b>Total Bonos:</b> ${r.totalBonos.toLocaleString('es-CL')}</p>`;

  let html='<table><thead><tr><th>Trabajador</th><th>Ventas</th><th>Utilidad</th><th>Bono</th></tr></thead><tbody>';
  for(const [nombre,info] of Object.entries(r.resumenTrabajadores)){
    html+=`<tr>
      <td>${nombre}</td>
      <td>${info.ventas.toLocaleString('es-CL')}</td>
      <td>${info.utilidad.toLocaleString('es-CL')}</td>
      <td>${info.bonos.toLocaleString('es-CL')}</td>
    </tr>`;
  }
  html+='</tbody></table>';
  $('tabla').innerHTML=html;
});
</script>
</body>
</html>
