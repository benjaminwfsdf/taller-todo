<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paso 4 ¬∑ Filtro de aceite</title>

<style>
:root{
  --brand:#900000;--ink:#e9ecef;--muted:#b9c0c7;
  --bg:#0b0b0c;--panel:#0f0f11;--card:#16181b;--card-border:#272a2f;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--ink)}
.topbar{background:#000;color:#fff;text-align:center;padding:14px;border-bottom:4px solid var(--brand);font-weight:700}
.wrapper{max-width:900px;margin:24px auto;padding:0 12px}
.frame{border:3px solid var(--brand);border-radius:16px;padding:20px;background:var(--panel)}
.header{background:var(--brand);padding:18px;border-radius:14px;text-align:center}
.card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;padding:16px;margin-top:20px}

.check{
  display:flex;align-items:center;gap:12px;
  background:#0c0c0e;padding:12px;border-radius:10px;margin-bottom:12px;
}
.check input{transform:scale(1.3)}
.check label{flex:1}

input[type=file]{margin-top:10px;color:var(--muted)}
.ok{color:#7CFF7C;font-weight:700;display:none;margin-top:6px}
.error{display:none;margin-top:12px;color:#ffb3b3}

.btn{
  margin-top:20px;width:100%;min-height:48px;
  border-radius:12px;border:2px solid var(--brand);
  background:#0c0c0e;color:#fff;font-weight:800;cursor:pointer;
}
.btn:hover{background:var(--brand)}
</style>
</head>

<body>

<div class="topbar">WWW.ELSE√ëORDELOSESCANER.CL</div>

<div class="wrapper">
<div class="frame">

<div class="header">
<h1>üõ¢Ô∏è Paso 4 ¬∑ Cambio de filtro</h1>
</div>

<div class="card">

<div class="check">
  <input type="checkbox" id="filtro_viejo">
  <label for="filtro_viejo">Filtro viejo retirado</label>
</div>

<div class="check">
  <input type="checkbox" id="sello_viejo">
  <label for="sello_viejo">Sello viejo retirado</label>
</div>

<div class="check">
  <input type="checkbox" id="filtro_nuevo">
  <label for="filtro_nuevo">Filtro nuevo instalado</label>
</div>

<strong>üì∏ Foto filtro instalado (opcional)</strong><br>
<input type="file" id="fotoFiltro" accept="image/*">
<div id="okFoto" class="ok">‚úî Foto registrada</div>

<div id="error" class="error">
‚ùå Debes confirmar todos los pasos del cambio de filtro.
</div>

<button class="btn" onclick="guardar()">Guardar y continuar</button>

</div>
</div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbxEYzoxATV0Cqn6zpug6PPTBRyO62XToCtEhk2F_Hgrq9v99f8zZr473PB6j_5v8e1qwA/exec";
const id=sessionStorage.getItem("aceite_id");

fotoFiltro.onchange = () => okFoto.style.display = "block";

async function apiGet(p){
  const r = await fetch(API_URL + "?" + new URLSearchParams(p));
  return r.json();
}

async function guardar(){
  if(!id){
    alert("Sesi√≥n perdida");
    location.href="aceite_nuevo.html";
    return;
  }

  if(!(filtro_viejo.checked && sello_viejo.checked && filtro_nuevo.checked)){
    error.style.display="block";
    return;
  }

  await apiGet({
    action: "actualizar_servicio",
    id_servicio: id,
    p4_filtro_viejo_retirado: filtro_viejo.checked ? "SI" : "NO",
    p4_sello_viejo_retirado: sello_viejo.checked ? "SI" : "NO",
    p4_filtro_nuevo_instalado: filtro_nuevo.checked ? "SI" : "NO",
    p4_foto_filtro_url: fotoFiltro.files.length ? "PENDIENTE_SUBIDA" : ""
  });

  location.href="aceite_paso5.html";
}
</script>

</body>
</html>
