<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Servicio</title>

<style>
:root{
  --brand:#900000;--ink:#e9ecef;--muted:#b9c0c7;
  --bg:#0b0b0c;--panel:#0f0f11;--card:#16181b;--card-border:#272a2f;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--ink)}
.topbar{background:#000;color:#fff;text-align:center;padding:14px;border-bottom:4px solid var(--brand);font-weight:700}
.wrapper{max-width:900px;margin:24px auto;padding:0 12px}
.frame{border:3px solid var(--brand);border-radius:16px;padding:20px;background:var(--panel)}
.header{background:var(--brand);padding:18px;border-radius:14px;text-align:center}
.card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;padding:16px;margin-top:16px}
.row{display:flex;justify-content:space-between;gap:10px;border-bottom:1px solid #333;padding:8px 0}
.row:last-child{border-bottom:none}
.label{color:var(--muted)}
.value{font-weight:700;text-align:right}

.section{margin-top:24px}
.section h3{margin-bottom:12px}

.foto-link{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  background:#0c0c0e;
  border:1px dashed #444;
  border-radius:10px;
  margin-bottom:10px;
}

.foto-link a{
  color:#7db7ff;
  font-weight:700;
  text-decoration:none;
}

.foto-link a:hover{
  text-decoration:underline;
}

.note{margin-top:14px;background:#0c0c0e;padding:12px;border-radius:10px;border:1px dashed #444}
.footer{text-align:center;color:var(--muted);font-size:12px;margin-top:18px}
</style>
</head>

<body>

<div class="topbar">WWW.ELSE√ëORDELOSESCANER.CL</div>

<div class="wrapper">
<div class="frame">

<div class="header">
  <h1>üõ¢Ô∏è Registro de Cambio de Aceite</h1>
</div>

<div id="contenido" class="card">Cargando registro‚Ä¶</div>

<div class="footer">
Este registro respalda el servicio realizado.
</div>

</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxAgXWy1VKHJU5rMFJViA_bWthtZ45ukt-_06iHv0LQ1D1YoQ1WRilTzMCYqKOZkEXZSw/exec";
const id = new URLSearchParams(location.search).get("id");

function formatearFecha(v){
  if(!v) return "‚Äî";
  return new Date(v).toLocaleDateString("es-CL");
}

async function apiGet(p){
  const r = await fetch(API_URL + "?" + new URLSearchParams(p));
  return r.json();
}

async function cargar(){
  if(!id){
    contenido.innerText="Registro no v√°lido.";
    return;
  }

  const r = await apiGet({ action:"obtener_servicio", id_servicio:id });
  if(!r || r.error){
    contenido.innerText="Registro no encontrado.";
    return;
  }

  contenido.innerHTML = `
    <div class="row"><span class="label">Patente</span><span class="value">${r.patente}</span></div>
    <div class="row"><span class="label">Fecha</span><span class="value">${formatearFecha(r.fecha_cierre)}</span></div>
    <div class="row"><span class="label">Kilometraje</span><span class="value">${r.km_inicial || "‚Äî"} km</span></div>
    <div class="row"><span class="label">Aceite</span><span class="value">${(r.aceite_tipo||"")} ${(r.aceite_norma||"")}</span></div>
    <div class="row"><span class="label">Cantidad</span><span class="value">${r.aceite_cantidad_litros || "‚Äî"} L</span></div>

    <div class="section">
      <h3>üì∏ Evidencia del Servicio</h3>

      ${linkFoto("Paso 2 ¬∑ Estado del aceite antes del servicio", r.p2_foto_aceite_url)}
      ${linkFoto("Paso 2 ¬∑ Estado del filtro antes del cambio", r.p2_foto_filtro_url)}
      ${linkFoto("Paso 4 ¬∑ Filtro nuevo instalado", r.p4_foto_filtro_url)}
      ${linkFoto("Paso 6 ¬∑ Verificaci√≥n final / nivel de aceite", r.p6_foto_final_url)}
    </div>

    <div class="note">
      <strong>Observaciones finales:</strong><br>
      ${r.observaciones_finales || "SIN OBSERVACIONES"}
    </div>
  `;
}

function linkFoto(texto, url){
  if(!url) return "";
  return `
    <div class="foto-link">
      <span>${texto}</span>
      <a href="${url}" target="_blank">üì∑ Ver foto</a>
    </div>
  `;
}

cargar();
</script>

</body>
</html>
